// Generated by purs version 0.11.7
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Apply = require("../Control.Apply");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Eff = require("../Control.Monad.Eff");
var Control_Monad_Free_Trans = require("../Control.Monad.Free.Trans");
var Control_Semigroupoid = require("../Control.Semigroupoid");
var Data_Array = require("../Data.Array");
var Data_Bifunctor = require("../Data.Bifunctor");
var Data_Eq = require("../Data.Eq");
var Data_EuclideanRing = require("../Data.EuclideanRing");
var Data_Foldable = require("../Data.Foldable");
var Data_Function = require("../Data.Function");
var Data_Functor = require("../Data.Functor");
var Data_HeytingAlgebra = require("../Data.HeytingAlgebra");
var Data_Identity = require("../Data.Identity");
var Data_Int = require("../Data.Int");
var Data_Lens = require("../Data.Lens");
var Data_Maybe = require("../Data.Maybe");
var Data_Ord = require("../Data.Ord");
var Data_Ring = require("../Data.Ring");
var Data_Semigroup = require("../Data.Semigroup");
var Data_Semiring = require("../Data.Semiring");
var Data_Show = require("../Data.Show");
var Data_Tuple = require("../Data.Tuple");
var Data_Unit = require("../Data.Unit");
var Fingering = require("../Fingering");
var Fret = require("../Fret");
var Graphics_Canvas = require("../Graphics.Canvas");
var Graphics_Canvas_Free = require("../Graphics.Canvas.Free");
var Halogen_HTML = require("../Halogen.HTML");
var Interval = require("../Interval");
var Partial_Unsafe = require("../Partial.Unsafe");
var Point = require("../Point");
var Prelude = require("../Prelude");
var UI_CanvasUtils = require("../UI.CanvasUtils");
var UI_ChordDiagram_Types = require("../UI.ChordDiagram.Types");
var spacing = 7.0;
var num_strings = 6;
var num_frets = 4;
var line_width = 1.0;
var font_size = 20;
var dot_t = function (v) {
    return new Data_Tuple.Tuple(5.0 - v.value1, v.value0 - 0.5);
};
var dark_grey = "#111111";
var chord_perc = 0.6;
var as_t = function (t) {
    return function (v) {
        return new Data_Tuple.Tuple(t.m11 * v.value0 + t.m31, t.m22 * v.value1 + t.m32);
    };
};
var paint_chord_diagram = function (state) {
    return function (id) {
        var paint_note_open = function (v) {
            return Control_Apply.applySecond(Control_Monad_Free_Trans.applyFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Control_Apply.applySecond(Control_Monad_Free_Trans.applyFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.beginPath(Data_Identity.monadIdentity))(Graphics_Canvas_Free.arc(Data_Identity.monadIdentity)(UI_CanvasUtils.circle({
                x: v.value0,
                y: v.value1,
                r: 6.0
            }))))(Graphics_Canvas_Free.stroke(Data_Identity.monadIdentity));
        };
        var paint_note_fretted = function (v) {
            return Control_Apply.applySecond(Control_Monad_Free_Trans.applyFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Control_Apply.applySecond(Control_Monad_Free_Trans.applyFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.beginPath(Data_Identity.monadIdentity))(Graphics_Canvas_Free.arc(Data_Identity.monadIdentity)(UI_CanvasUtils.circle({
                x: v.value0,
                y: v.value1,
                r: 6.0
            }))))(Graphics_Canvas_Free.fill(Data_Identity.monadIdentity));
        };
        var paint_line = function (v) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.stroke(Data_Identity.monadIdentity))(function () {
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Tuple.uncurry(Graphics_Canvas_Free.moveTo(Data_Identity.monadIdentity))(v.value0))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Tuple.uncurry(Graphics_Canvas_Free.lineTo(Data_Identity.monadIdentity))(v.value1))(function () {
                        return Graphics_Canvas_Free.closePath(Data_Identity.monadIdentity);
                    });
                });
            });
        };
        var dot_shift_t = (function () {
            var min_fret = Interval.inf(Fingering.fret_interval(state.fingering));
            var m = Data_Maybe.maybe(0.0)(function ($58) {
                return Data_Int.toNumber(Fret.unfret($58));
            })(min_fret);
            var $35 = m <= 1.0;
            if ($35) {
                return dot_t;
            };
            return function ($59) {
                return Data_Bifunctor.rmap(Data_Tuple.bifunctorTuple)(function (v) {
                    return v - (m - 1.0);
                })(dot_t($59));
            };
        })();
        var alpha = state.dimensions.width * chord_perc;
        var h_margin = (state.dimensions.width - alpha) / 2.0;
        var v_margin = (state.dimensions.height - alpha - Data_Int.toNumber(font_size) - spacing) / 2.0;
        var canvas_transform = {
            m11: alpha / Data_Int.toNumber(num_strings - 1 | 0),
            m12: 0.0,
            m21: 0.0,
            m22: alpha / Data_Int.toNumber(num_frets),
            m31: h_margin,
            m32: v_margin + Data_Int.toNumber(font_size) + spacing
        };
        var paint_dots = (function () {
            var v = Data_Array.partition(function ($60) {
                return 0.0 === Data_Tuple.fst($60);
            })(Fingering.to_points(state.fingering));
            var abs_pos = function ($61) {
                return as_t(canvas_transform)(dot_shift_t($61));
            };
            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.setLineWidth(Data_Identity.monadIdentity)(line_width))(function () {
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Foldable.traverse_(Control_Monad_Free_Trans.applicativeFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Foldable.foldableArray)(function ($62) {
                    return paint_note_open(abs_pos($62));
                })(v.yes))(function () {
                    return Data_Foldable.traverse_(Control_Monad_Free_Trans.applicativeFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Foldable.foldableArray)(function ($63) {
                        return paint_note_fretted(abs_pos($63));
                    })(v.no);
                });
            });
        })();
        var paint_grid = (function () {
            var v = new Data_Tuple.Tuple(0, 0);
            var v1 = new Data_Tuple.Tuple(num_strings, num_frets);
            var vrline = function (x) {
                return new Data_Tuple.Tuple(Point.point_int(x)(v.value1), Point.point_int(x)(v1.value1));
            };
            var paint_nut = Graphics_Canvas_Free.rect(Data_Identity.monadIdentity)({
                x: 0.0,
                y: 0.1,
                w: Data_Int.toNumber(num_frets - 1 | 0),
                h: 0.1
            });
            var hrline = function (y) {
                return new Data_Tuple.Tuple(Point.point_int(v.value0)(y), Point.point_int(v1.value0 - 1 | 0)(y));
            };
            var lines = Data_Semigroup.append(Data_Semigroup.semigroupArray)(Data_Functor.map(Data_Functor.functorArray)(hrline)(Data_Array.range(v.value1)(v1.value1)))(Data_Functor.map(Data_Functor.functorArray)(vrline)(Data_Array.range(v.value0)(v1.value0)));
            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.save(Data_Identity.monadIdentity))(function () {
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.transform(Data_Identity.monadIdentity)(canvas_transform))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.setLineWidth(Data_Identity.monadIdentity)(5.0e-2))(function () {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Foldable.traverse_(Control_Monad_Free_Trans.applicativeFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Foldable.foldableArray)(paint_line)(lines))(function () {
                            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))((function () {
                                var $41 = !Fingering.is_open(state.fingering);
                                if ($41) {
                                    return Control_Applicative.pure(Control_Monad_Free_Trans.applicativeFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Unit.unit);
                                };
                                return paint_nut;
                            })())(function () {
                                return Graphics_Canvas_Free.restore(Data_Identity.monadIdentity);
                            });
                        });
                    });
                });
            });
        })();
        var paint_location = (function () {
            var v = Interval.inf(Fingering.fret_interval(state.fingering));
            if (v instanceof Data_Maybe.Nothing) {
                return Control_Applicative.pure(Control_Monad_Free_Trans.applicativeFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Unit.unit);
            };
            if (v instanceof Data_Maybe.Just) {
                var $47 = v.value0 <= 1;
                if ($47) {
                    return Control_Applicative.pure(Control_Monad_Free_Trans.applicativeFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Data_Unit.unit);
                };
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.setFont(Data_Identity.monadIdentity)(Data_Show.show(Data_Show.showString)("9px Georgia")))(function () {
                    return Control_Bind.bind(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.measureText(Data_Identity.monadIdentity)(Data_Show.show(Data_Show.showInt)(v.value0)))(function (v1) {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.setFillStyle(Data_Identity.monadIdentity)(dark_grey))(function () {
                            return Graphics_Canvas_Free.fillText(Data_Identity.monadIdentity)(Data_Show.show(Data_Show.showInt)(v.value0))(h_margin - v1.width - 2.0)(v_margin + Data_Int.toNumber(font_size) * 1.5 + spacing);
                        });
                    });
                });
            };
            throw new Error("Failed pattern match at UI.ChordDiagram.Canvas line 108, column 20 - line 116, column 98: " + [ v.constructor.name ]);
        })();
        var paint_title = Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.setFont(Data_Identity.monadIdentity)(Data_Show.show(Data_Show.showInt)(font_size) + "px Georgia"))(function () {
            return Control_Bind.bind(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.measureText(Data_Identity.monadIdentity)(state.name))(function (v) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(Graphics_Canvas_Free.setFillStyle(Data_Identity.monadIdentity)(dark_grey))(function () {
                    return Graphics_Canvas_Free.fillText(Data_Identity.monadIdentity)(state.name)((state.dimensions.width - v.width) / 2.0)(v_margin + Data_Int.toNumber(font_size) * 0.5);
                });
            });
        });
        return Data_Functor["void"](Control_Monad_Eff.functorEff)(function __do() {
            var v = Graphics_Canvas.getCanvasElementById(id)();
            var __unused = function (dictPartial1) {
                return function ($dollar11) {
                    return $dollar11;
                };
            };
            return __unused()((function () {
                if (v instanceof Data_Maybe.Just) {
                    return function __do() {
                        var v1 = Graphics_Canvas.getContext2D(v.value0)();
                        return Graphics_Canvas_Free.runGraphics(v1)(Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(paint_grid)(function () {
                            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(paint_dots)(function () {
                                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free_Trans.bindFreeT(Graphics_Canvas_Free.functorGraphicsF)(Data_Identity.monadIdentity))(paint_title)(function () {
                                    return paint_location;
                                });
                            });
                        }))();
                    };
                };
                throw new Error("Failed pattern match at UI.ChordDiagram.Canvas line 52, column 3 - line 52, column 41: " + [ v.constructor.name ]);
            })())();
        });
    };
};
module.exports = {
    paint_chord_diagram: paint_chord_diagram
};
