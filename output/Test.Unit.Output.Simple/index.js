// Generated by purs version 0.11.7
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Aff_AVar = require("../Control.Monad.Aff.AVar");
var Control_Monad_Aff_Console = require("../Control.Monad.Aff.Console");
var Control_Monad_Eff_Console = require("../Control.Monad.Eff.Console");
var Control_Monad_Eff_Exception = require("../Control.Monad.Eff.Exception");
var Control_Semigroupoid = require("../Control.Semigroupoid");
var Data_Either = require("../Data.Either");
var Data_Foldable = require("../Data.Foldable");
var Data_Function = require("../Data.Function");
var Data_List = require("../Data.List");
var Data_List_Types = require("../Data.List.Types");
var Data_Maybe = require("../Data.Maybe");
var Data_Monoid = require("../Data.Monoid");
var Data_Ring = require("../Data.Ring");
var Data_Semigroup = require("../Data.Semigroup");
var Data_Semiring = require("../Data.Semiring");
var Data_Show = require("../Data.Show");
var Data_Tuple = require("../Data.Tuple");
var Data_Unit = require("../Data.Unit");
var Prelude = require("../Prelude");
var Test_Unit = require("../Test.Unit");
var indent = function (v) {
    if (v === 0) {
        return Data_Monoid.mempty(Data_Monoid.monoidString);
    };
    return "  " + indent(v - 1 | 0);
};
var indent$prime = function ($30) {
    return indent(Data_List.length($30));
};
var printLive = function (tst) {
    var runSuiteItem = function (path) {
        return function (v) {
            if (v instanceof Data_Either.Left) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_Console.log(indent$prime(path) + ("- Suite: " + v.value0)))(function () {
                    return Control_Applicative.pure(Control_Monad_Aff.applicativeAff)(Data_Unit.unit);
                });
            };
            if (v instanceof Data_Either.Right) {
                return Control_Bind.bind(Control_Monad_Aff.bindAff)(Control_Monad_Aff.attempt(v.value0.value1))(function (v1) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)((function () {
                        if (v1 instanceof Data_Either.Right) {
                            return Control_Monad_Aff_Console.log(indent$prime(path) + ("\u2713 Passed: " + v.value0.value0));
                        };
                        if (v1 instanceof Data_Either.Left) {
                            return Control_Monad_Aff_Console.log(indent$prime(path) + ("\u2620 Failed: " + (v.value0.value0 + (" because " + Control_Monad_Eff_Exception.message(v1.value0)))));
                        };
                        throw new Error("Failed pattern match at Test.Unit.Output.Simple line 35, column 7 - line 39, column 59: " + [ v1.constructor.name ]);
                    })())(function () {
                        return Control_Applicative.pure(Control_Monad_Aff.applicativeAff)(Data_Unit.unit);
                    });
                });
            };
            throw new Error("Failed pattern match at Test.Unit.Output.Simple line 30, column 5 - line 32, column 16: " + [ path.constructor.name, v.constructor.name ]);
        };
    };
    return Test_Unit.walkSuite(runSuiteItem)(tst);
};
var printErrors = function (tests) {
    return function (skCount) {
        var printHeader = function (level) {
            return function (path) {
                var v = Data_List.uncons(path);
                if (v instanceof Data_Maybe.Nothing) {
                    return Control_Applicative.pure(Control_Monad_Aff.applicativeAff)(Data_Unit.unit);
                };
                if (v instanceof Data_Maybe.Just) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_Console.log(indent(level) + ("In \"" + (v.value0.head + "\":"))))(function () {
                        return printHeader(level + 1 | 0)(v.value0.tail);
                    });
                };
                throw new Error("Failed pattern match at Test.Unit.Output.Simple line 64, column 34 - line 68, column 41: " + [ v.constructor.name ]);
            };
        };
        var printError = function (err) {
            return Control_Monad_Aff_Console.log("Error: " + Data_Maybe.fromMaybe(Control_Monad_Eff_Exception.message(err))(Control_Monad_Eff_Exception.stack(err)));
        };
        var print = function (v) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(printHeader(0)(v.value0))(function () {
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(printError(v.value1))(function () {
                    return Control_Monad_Aff_Console.log("");
                });
            });
        };
        var list = Data_Foldable.traverse_(Control_Monad_Aff.applicativeAff)(Data_List_Types.foldableList)(print);
        return Control_Bind.bind(Control_Monad_Aff.bindAff)(Test_Unit.collectResults(tests))(function (v) {
            var skMsg = (function () {
                if (skCount === 0) {
                    return "";
                };
                if (skCount === 1) {
                    return " (1 test skipped)";
                };
                return " (" + (Data_Show.show(Data_Show.showInt)(skCount) + " tests skipped)");
            })();
            var errors = Test_Unit.keepErrors(v);
            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_Console.log(""))(function () {
                var v1 = Data_List.length(errors);
                if (v1 === 0) {
                    return Control_Monad_Aff_Console.log("All " + (Data_Show.show(Data_Show.showInt)(Data_List.length(v)) + (" tests passed" + (skMsg + "!"))));
                };
                if (v1 === 1) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_Console.log("1 test failed" + (skMsg + ":\x0a")))(function () {
                        return list(errors);
                    });
                };
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_Console.log(Data_Show.show(Data_Show.showInt)(v1) + (" tests failed" + (skMsg + ":\x0a"))))(function () {
                    return list(errors);
                });
            });
        });
    };
};
var runTest = function (suite) {
    return Control_Bind.bind(Control_Monad_Aff.bindAff)(printLive(suite))(function (v) {
        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(printErrors(v)(Test_Unit.countSkippedTests(suite)))(function () {
            return Control_Applicative.pure(Control_Monad_Aff.applicativeAff)(v);
        });
    });
};
module.exports = {
    runTest: runTest
};
